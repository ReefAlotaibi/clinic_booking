<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:'Tahoma',sans-serif;direction:rtl;background:#f7f7f7;margin:0}
    header{background:#0066cc;color:#fff;padding:20px;text-align:center}
    .dashboard{display:flex;flex-wrap:wrap;justify-content:space-around;padding:20px}
    .card{background:#fff;box-shadow:0 0 10px rgba(0,0,0,.1);border-radius:10px;margin:10px;padding:20px;flex:1 1 400px;max-width:45%}
    .chart-box{max-width:560px;margin:0 auto}
    canvas{width:100% !important;height:320px !important}
    table{width:100%;border-collapse:collapse;table-layout:fixed}
    th,td{padding:10px;border:1px solid #ddd;text-align:center;word-break:break-word}
    .alert{padding:10px;background:#ffdddd;border:1px solid #ff5c5c;border-radius:5px;margin-top:10px}
    @media print{
      body{width:210mm;height:297mm;margin:10mm;font-size:12px}
      .dashboard{display:block;width:100%}
      .card{page-break-inside:avoid;width:100% !important;margin-bottom:20px;box-shadow:none}
      table{width:100% !important;table-layout:fixed;word-wrap:break-word;font-size:11px}
      canvas{max-width:100% !important;height:260px !important}
      .no-print,button{display:none !important}
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª - Ù…Ø¬Ù…Ø¹ Ø£Ø·Ù„Ø³ Ø§Ù„Ø·Ø¨ÙŠ </h1>
    <p id="today-date" style="margin:5px;font-size:18px;"></p>
    <div class="no-print" style="text-align:right;padding:10px 20px;">
      <button onclick="window.print()" style="padding:8px 16px;font-size:15px;">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
  </header>

  <div class="dashboard">
    <!-- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© (Ø«Ø§Ø¨Øª) -->
    <div class="card">
      <h2>Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©</h2>
      <div class="chart-box">
        <canvas id="peakChart"></canvas>
      </div>
    </div>

    <!-- Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Ø«Ø§Ø¨Øª) -->
    <div class="card">
      <h2>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
      <table>
        <thead><tr><th>Ø§Ù„Ø·Ø¨ÙŠØ¨</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead>
        <tbody>
          <tr><td>Ø¯. ÙÙŠÙÙŠ Ø¹Ø¨Ø§Ø³</td><td>Ø¬Ù„Ø¯ÙŠØ©</td><td>5:00 Ù…Ø³Ø§Ø¡Ù‹</td></tr>
          <tr><td>Ø¯. Ù‚Ù…Ø± Ø§Ù„Ø±ÙØ§Ø¹ÙŠ</td><td>Ø£Ø³Ù†Ø§Ù† Ø¹Ø§Ù…</td><td>10:00 ØµØ¨Ø§Ø­Ù‹Ø§</td></tr>
          <tr><td>Ø¯.  Ø£Ø­Ù…Ø¯ Ø¹Ù…Ø§Ø±</td><td>ØªÙ‚ÙˆÙŠÙ…</td><td>3:00 Ù…Ø³Ø§Ø¡Ù‹</td></tr>
        </tbody>
      </table>
    </div>

    <!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø«Ø§Ø¨Øª) -->
    <div class="card">
      <h2>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø²Ø­Ø§Ù…</h2>
      <div class="alert">âš  Ø§Ù„Ø²Ø­Ù…Ø© ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© 4Ù… Ø­ØªÙ‰ 9Ù….</div>
      <div class="alert">âš  Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù…Ù…ØªÙ„Ø¦Ø© ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø³Ø¨Øª ÙˆØ§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡.</div>
      <div class="alert">âœ… Ø§Ù„Ø³Ø§Ø¹Ø© 12Ù… Ø¥Ù„Ù‰ 3Ù… Ø£Ù‚Ù„ ÙˆÙ‚Øª Ø§Ø²Ø¯Ø­Ø§Ù….</div>
    </div>

    <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª (Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù…Ù† Google Sheets) -->
    <div class="card">
      <h2>Ø¹Ø¯Ø¯ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Google Sheets)</h2>
      <div class="chart-box">
        <canvas id="visitsChart"></canvas>
      </div>
      <p id="totalVisits" style="text-align:center;font-size:16px;margin-top:10px;"></p>
      <p style="text-align:center;font-size:13px;color:gray;">ğŸ”„ ÙŠØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Google Sheets</p>
    </div>
  </div>

  <script>


// Ø§Ù„ØªØ§Ø±ÙŠØ®
    (function(){
      const today = new Date();
      const opt = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
      document.getElementById('today-date').textContent =
        "ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…: " + today.toLocaleDateString('ar-EG', opt);
    })();

    // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© (Ø«Ø§Ø¨Øª)
    (function(){
      const ctx = document.getElementById('peakChart').getContext('2d');
      const labels = ['9 Øµ','10 Øµ','11 Øµ','12 Ø¸','1 Ù…','2 Ù…','3 Ù…','4 Ù…','5 Ù…','6 Ù…','7 Ù…','8 Ù…','9 Ù…'];
      const vals   = [3,6,4,3,5,6,8,10,12,11,9,7,4];
      const colors = vals.map(v => v>=10 ? '#cc0000' : v>=6 ? '#ffa500' : '#28a745');
      new Chart(ctx,{
        type:'bar',
        data:{ labels, datasets:[{ label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª', data:vals, backgroundColor:colors }] },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{display:false}, title:{display:true, text:'Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©'} },
          scales:{ y:{ beginAtZero:true } }
        }
      });
    })();

    // ==== Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ù…Ù† Google Sheets (DashboardData CSV) ====
    const sheetCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2-wtcsZJlDXPBL_-WHldwl3HiO2fFCJ5xokezULto8AYpXUIMB8bqPuWsfJSVgpjQHJYDyhm4_RQE/pub?gid=1442116717&single=true&output=csv';

    window.addEventListener('DOMContentLoaded', loadVisits);

    async function loadVisits(){
      try{
        const res  = await fetch(sheetCSV, { cache:'no-store' });
        const text = await res.text();

        const rows = text.trim().split(/\r?\n/).map(r => r.split(','));
        if(!rows.length) throw new Error('CSV ÙØ§Ø±Øº');
        rows[0][0] = rows[0][0].replace(/^\uFEFF/, '').trim();
        const headers = rows[0].map(h => h.trim());

        const idxClinic = headers.findIndex(h => h.includes('Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©'));
        const idxVisits = headers.findIndex(h => h.includes('Ø²ÙŠØ§Ø±Ø§Øª') || h.toLowerCase().includes('sum'));
        if(idxClinic === -1 || idxVisits === -1) throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© / Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª');

        const labs = [], vals = [];
        for(let i=1;i<rows.length;i++){
          const c = (rows[i][idxClinic] || '').trim();
          const v = parseFloat((rows[i][idxVisits] || '0').toString().replace(/[^\d.]/g,'')) || 0;
          if(c){ labs.push(c); vals.push(v); }
        }

        const vctx = document.getElementById('visitsChart').getContext('2d');
        new Chart(vctx,{
          type:'bar',
          data:{ labels:labs, datasets:[{ label:'Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª', data:vals, backgroundColor:'#4caf50' }] },
          options:{
            responsive:true, maintainAspectRatio:false,
            plugins:{ legend:{display:false}, title:{display:true, text:'Ø¹Ø¯Ø¯ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª (Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)'} },
            scales:{ y:{ beginAtZero:true } }
          }
        });

        const total = vals.reduce((a,b)=>a+b,0);
        document.getElementById('totalVisits').innerHTML =
          'ğŸ”¢ <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</strong> ' + total + ' Ø²ÙŠØ§Ø±Ø©';
      }catch(e){
        console.error(e);
        const el = document.getElementById('totalVisits');
        if(el) el.textContent = 'ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø±Ø§Ø¨Ø· CSV ÙˆØ¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ DashboardData.';
      }
    }
  </script>
</body>
</html>
